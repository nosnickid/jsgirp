<!DOCTYPE html>
<html>
<head>
    <title>Javascript Box 2D Girp</title>
</head>
<body>


<h1>JS reinterpretation of GIRP</h1>

<canvas id="display" width="800" height="600" style="background: black; border: 1px solid black;"></canvas>



<script src="js/jquery-1.7.2.min.js" type="text/javascript"></script>
<script src="js/Box2dWeb-2.1.a.3.js" type="text/javascript" type="text/javascript"></script>
<script src="js/draw_world.js" type="text/javascript" type="text/javascript"></script>
<script src="girp.js" type="text/javascript" type="text/javascript"></script>

<script type="text/javascript">
    var world;
    var girp;

    var canvas = $("#display")[0];
    var ctx = canvas.getContext('2d');
    var canvasWidth = canvas.width;
    var canvasHeight = canvas.height;
    var timeout;

    window.setRenderContext(ctx);

    function init() {
        var gravity = new Box2D.Common.Math.b2Vec2(0, 300);
        var doSleep = true;

        world = new Box2D.Dynamics.b2World(gravity, doSleep);

        girp = new GirpGame();
        girp.initWorld(world);
        girp.bindInput(window);
        clearTimeout(timeout);
    }

    function draw() {
        ctx.clearRect(-canvasWidth, -canvasHeight, 2*canvasWidth, 2*canvasHeight);
        //drawVector(-100, 0, 100, 0, "#ff0000");
        //drawVector(0, -100, 0, 100, "#00ff00");

        window.drawWorld(world);
    }

    function step(cnt) {
        var stepping = false;
        var timeStep = 1.0/60;
        var velocityIterations = 5;
        var positionIterations = 5;
        world.Step(timeStep, velocityIterations, positionIterations);
        world.ClearForces();
        girp.tick();
        draw();
        if (cnt > 0) {
            timeout = setTimeout('step(' + (cnt || 0) + ')', 10);
        }
    }

    init();
    step(1);

    d_velocityVector = 1;

</script>

<div style="cursor: pointer;" onclick="init(); step(1)">go</div>
<div style="cursor: pointer;" onclick="init(); draw()">reset</div>

<input type="checkbox" id="vel" onchange="window.d_velocityVector = this.checked;"><label for="vel">draw velocity vectors</label>

</body>
</html>