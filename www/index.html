<!DOCTYPE html>
<html>
<head>
    <title>Javascript Box 2D Girp</title>
    <link href="css/ui-lightness/jquery-ui-1.8.21.custom.css" media="screen" rel="stylesheet" />
    <link href="css/player_editor.css" media="screen" rel="stylesheet" />
</head>
<body>


<h1>JS reinterpretation of GIRP</h1>

<canvas id="display" width="800" height="600" style="background: black; border: 1px solid black;"></canvas>



<script src="js/jquery-1.7.2.min.js" type="text/javascript"></script>
<script src="js/jquery-ui-1.8.21.custom.min.js" type="text/javascript"></script>
<script src="js/Box2dWeb-2.1.a.3.js" type="text/javascript" ></script>
<script src="js/polyfill.requestAnimationFrame.js" type="text/javascript"></script>
<script src="js/backbone-0.9.2.js" type="text/javascript"></script>
<script src="js/draw_world.js" type="text/javascript" ></script>
<script src="girp.js" type="text/javascript"></script>

<script type="text/javascript">
    var girp;

    var canvas = $("#display")[0];
    var ctx = canvas.getContext('2d');
    var canvasWidth = canvas.width;
    var canvasHeight = canvas.height;
    var timeout;
    var playerDef;

    /* dodgy call into our dodgy renderer. */
    window.setRenderContext(ctx);

    function init() {
        playerDef = new GirpPlayerDef();
        $.extend(playerDef, Backbone.Events);

        playerDef.on("change", function() {
            resetGame();
            draw();
        });

    }

    function resetGame() {
        if (girp) girp.stop();

        girp = new GirpGame();
        girp.initWorld(playerDef);
        girp.bindInput(window);
        girp.setRenderCallback(draw);
    }

    function draw() {
        ctx.clearRect(-canvasWidth, -canvasHeight, 2*canvasWidth, 2*canvasHeight);
        //drawVector(-100, 0, 100, 0, "#ff0000");
        //drawVector(0, -100, 0, 100, "#00ff00");

        window.drawWorld(girp.world);
    }

    init();
    resetGame();
    girp.start();

    d_velocityVector = 1;

    /* Start the user editing UI */
    $(function() {
        $(".slider").slider({
            slide: function(event, ui) {
                var field = event.target.getAttribute('data-player-field');
                window.playerDef[field] = ui.value;
                window.playerDef.trigger("change");
            }
        });
    });

</script>

<div style="cursor: pointer;" onclick="resetGame(); girp.start();">go</div>
<div style="cursor: pointer;" onclick="resetGame(); draw()">reset</div>

<input type="checkbox" id="vel" onchange="window.d_velocityVector = this.checked;"><label for="vel">draw velocity vectors</label>

<div id="player_editor">
    <h1>Player Editor</h1>
    <h2>Torso</h2>

    <div class="row">
        <label for="bodySizeWidth">Width:</label>
        <span data-player-field="bodySizeWidth" id="bodySizeWidth" class="slider"></span>
    </div>

    <div class="row">
        <label for="bodySizeHeight">Height:</label>
        <span data-player-field="bodySizeHeight" id="bodySizeHeight" class="slider"></span>
    </div>

</div>

</body>
</html>